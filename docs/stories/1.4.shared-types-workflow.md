# Story 1.4: Establish Shared Types and Dev Workflow

## Status

Appreoved

## Story

**As a** developer,  
**I want** shared TypeScript types and a complete development workflow with linting, formatting, and tooling,  
**so that** I can maintain type safety across the full stack and have efficient development cycles.

## Acceptance Criteria

1. Shared TypeScript types package created and linked to all workspaces
2. ESLint configured for consistent code style across all packages
3. Prettier configured for automatic code formatting
4. Turbo build pipeline configured for optimized builds
5. Git hooks setup with Husky for pre-commit checks
6. Development scripts working across all packages
7. Health check command validates entire system setup
8. Type safety verified between frontend and backend
9. Hot reload working simultaneously for all packages

## Tasks / Subtasks

- [ ] **Task 1: Create shared types package** (AC: 1, 8)
  - [ ] Navigate to packages/shared directory
  - [ ] Initialize package with `pnpm init`
  - [ ] Create tsconfig.json for library output
  - [ ] Create src/types directory structure:
    - src/types/models.ts (data models)
    - src/types/api.ts (API interfaces)
    - src/types/websocket.ts (WebSocket events)
  - [ ] Implement TypeScript interfaces from data models:
    - RedditPost
    - VideoScript
    - VideoAsset
    - BackgroundMusic
    - VideoOutput
    - ProcessingStatus enum

- [ ] **Task 2: Link shared package to workspaces** (AC: 1, 8)
  - [ ] Update apps/web/package.json to reference @video-automation/shared
  - [ ] Update apps/server/package.json to reference @video-automation/shared
  - [ ] Configure TypeScript paths in both apps for imports
  - [ ] Test imports work correctly
  - [ ] Verify type checking across packages

- [ ] **Task 3: Configure ESLint** (AC: 2)
  - [ ] Install ESLint and plugins in root:
    - eslint: "^8.0.0"
    - @typescript-eslint/parser
    - @typescript-eslint/eslint-plugin
    - eslint-plugin-react
    - eslint-plugin-react-hooks
  - [ ] Create .eslintrc.js with:
    - TypeScript parser configuration
    - React rules for frontend
    - Node rules for backend
    - Shared rules for all packages
  - [ ] Create .eslintignore file
  - [ ] Add lint script to all package.json files

- [ ] **Task 4: Configure Prettier** (AC: 3)
  - [ ] Install Prettier in root:
    - prettier: "^3.0.0"
    - eslint-config-prettier
  - [ ] Create .prettierrc with:
    - Semi: true
    - Single quotes: true
    - Tab width: 2
    - Trailing comma: es5
  - [ ] Create .prettierignore file
  - [ ] Integrate with ESLint config
  - [ ] Add format script to root package.json

- [ ] **Task 5: Setup Turbo build pipeline** (AC: 4)
  - [ ] Create turbo.json in root with:
    - Pipeline configuration for dev, build, test, lint
    - Cache configuration
    - Dependency graph
  - [ ] Configure build outputs
  - [ ] Setup development pipeline
  - [ ] Test parallel builds
  - [ ] Verify caching works

- [ ] **Task 6: Configure Git hooks** (AC: 5)
  - [ ] Install Husky and lint-staged:
    - husky: "^8.0.0"
    - lint-staged: "^13.0.0"
  - [ ] Initialize Husky with `npx husky install`
  - [ ] Create pre-commit hook for:
    - ESLint checks
    - Prettier formatting
    - TypeScript compilation
  - [ ] Configure lint-staged in package.json
  - [ ] Test hooks with test commit

- [ ] **Task 7: Create development workflow scripts** (AC: 6, 9)
  - [ ] Update root package.json with comprehensive scripts:
    - dev: "turbo run dev --parallel"
    - dev:web: "turbo run dev --filter=web"
    - dev:server: "turbo run dev --filter=server"
    - build: "turbo run build"
    - test: "turbo run test"
    - lint: "turbo run lint"
    - format: "prettier --write \"\*_/_.{ts,tsx,js,jsx,json,md}\""
    - typecheck: "turbo run typecheck"
    - clean: "turbo run clean"
  - [ ] Ensure all scripts work correctly
  - [ ] Test hot reload for all packages

- [ ] **Task 8: Implement health check system** (AC: 7)
  - [ ] Create scripts/health-check.js with checks for:
    - Node.js version
    - pnpm installation
    - All dependencies installed
    - Database connection
    - TypeScript compilation
    - Frontend build
    - Backend server start
  - [ ] Add health-check script to root package.json
  - [ ] Create detailed output for any failures
  - [ ] Test with fresh installation

## Dev Notes

### Architecture Context

- **Type Sharing:** Single source of truth for all data models
- **Build Tool:** Turbo for monorepo optimization
- **Code Quality:** ESLint + Prettier + TypeScript strict mode
- **Git Hooks:** Husky for automated quality checks

### Shared Types Structure

```typescript
// ProcessingStatus enum
type ProcessingStatus =
  | "idea"
  | "idea_selected"
  | "script_generated"
  | "script_approved"
  | "assets_ready"
  | "rendering"
  | "completed"
  | "failed";

// All interfaces from data models section
```

### Development Commands

After this story, developers should be able to:

- `pnpm dev` - Start everything
- `pnpm build` - Build all packages
- `pnpm test` - Run all tests
- `pnpm lint` - Check code style
- `pnpm format` - Auto-format code

### Testing Standards

- Type checking must pass in strict mode
- ESLint should have zero errors
- Prettier should format consistently
- All packages should build successfully
- Health check should pass all validations

## Change Log

| Date       | Version | Description            | Author    |
| ---------- | ------- | ---------------------- | --------- |
| 2025-08-26 | 1.0     | Initial story creation | John (PM) |

## Dev Agent Record

(To be populated during implementation)

## QA Results

(To be populated during QA review)
